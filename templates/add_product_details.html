{% extends "base.html" %}
{% import "macros.j2" as macros %} 
{% block content %} 

    <h3 class="center-align">Add Product <strong><i>{{ session.role }}</i></strong> Details</h3>

    {% if product %} 

        <form action="{{ url_for('add_product_details', product_id=product._id) }}" method="post">

            {% for role in roles %}

                <h4><i class="material-icons">{{ role.role_logo }}</i> {{ role.role_name }} Details</h4>

                <div class="row">

                    {% if session.role in [role.role_name, "Admin"] %}

                        {% if field_list[(role.role_name.lower())+"_details"] is mapping %} 
                            {% for sub_heading, sub_array in field_list[(role.role_name.lower())+"_details"].items() %} 
                                <div class="col s12">
                                    <h5><strong><i>{{ sub_heading.replace("_", " ").title() }}</i></strong></h5>
                                </div>
                                {{ macros.form_builder(sub_array, product, context=sub_heading) }}
                                <div class="col s12">
                                    <hr>
                                </div>
                            {% endfor %}
                        {% elif role.role_name == "Commercial" %} 
                            {{ macros.form_builder(field_list[(role.role_name.lower())+"_details"], product, context="Commercial") }}
                        {% else %}
                            {{ macros.form_builder(field_list[(role.role_name.lower())+"_details"], product) }}
                        {% endif %}
                    
                    {% else %}

            <form action="{{ url_for('add_product_details', product_id=product._id) }}" method="post">
                <div class="row">
                    
                    {{ macros.form_builder(field_list[(session.role.lower())+"_details"], product) }}

                </div>

                <hr>
            
            {% endfor %}

            <div class="row">
                <div class="col s12 center-align">
                    <button class="btn-large green accent-3 center-align">
                        <i class="material-icons right">check</i> Submit
                    </button>
                    <a href="{{ url_for('view_product', product_id=product._id) }}" class="btn-large red accent-3 center-align">
                        <i class="material-icons right">cancel</i> Cancel
                    </a>
                </div>
            </div>

        </form>

        

        <!-- {% if session.role != "Commercial" and session.role != "Admin" %}

            <div class="row" id="product-details">

                {{ macros.view_builder(product.items(), context="Commercial") }}

            </div>
        
        {% else %}

            <form action="{{ url_for('add_product_details', product_id=product._id) }}" method="post">
                <div class="row">
                    
                    {{ macros.form_builder(field_list[(session.role.lower())+"_details"], product) }}

                </div> -->
                <!-- submit button -->
                <!-- <div class="row">
                    <div class="col s12 center-align">
                        <button class="btn-large green accent-3 center-align">
                            <i class="material-icons right">check</i> Submit
                        </button>
                        <a href="{{ url_for('view_product', product_id=product._id) }}" class="btn-large red accent-3 center-align">
                            <i class="material-icons right">cancel</i> Cancel
                        </a>
                    </div>
                </div>
            </form>

        {% endif %} -->

    {% endif %}

{% endblock %}