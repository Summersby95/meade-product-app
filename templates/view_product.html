{% extends "base.html" %} 
{% block content %} 

    <h3 class="center-align">Product Details</h3>

    <h4><i class="material-icons">credit_card</i> Commercial Details</h4>

    {% if product %} 

        <div class="row" id="product-details">
            {# we cycle through the product dictionary #}
            {% for field, value in product.items() %}
                {# we don't want to display the id of the product from the database.
                We also don't want to display if the value is mapping, ie an dictionary, 
                because that means it's one of the roles details for the product which are 
                displayed further down the page #}
                {% if field != "_id" and value is not mapping %} 
                    <div class="col s12 m6 row">
                        <div class="col s4">
                            <strong>{{ field.replace("_", " ").title() }}</strong>
                        </div>
                        <div class="col s8">
                            {# check if value is list or string #}
                            {% if value is iterable and (value is not string and value is not mapping) %}
                                {{ ", ".join(value) }}
                            {% else %}  
                                {{ value }}
                            {% endif %} 
                        </div>
                    </div>
                {% endif %}

            {% endfor %}

        </div>

    {% endif %}

    <hr>
    {# we cycle through the roles in our roles array #}
    {% for role in roles %} 

        <h4><i class="material-icons">card_giftcard</i> {{ role.role_name }} Details</h4>
        {# we check if the there is an object in the product for the role #}
        {% if product[role.role_name.lower()] %} 

            <div class="row">

                {% for field, value in product[role.role_name.lower()].items() %} 

                    <div class="col s12 m6 row">
                        <div class="col s4">
                            <strong>{{ field.replace("_", " ").title() }}</strong>
                        </div>
                        <div class="col s8">
                            {% if value is iterable and (value is not string and value is not mapping) %}
                                {{ ", ".join(value) }}
                            {% else %}  
                                {{ value }}
                            {% endif %} 
                        </div>
                    </div>

                {% endfor %}

            </div>

        {% else %} 

            <h5 class="center-align">No {{ role.role_name }} Details Submitted Yet</h5>

        {% endif %}

        <hr>

    {% endfor %}
    
    <br>
    {# Provide options to edit details and print pdf version of form at bottom of view #}
    <div class="row">
        <div class="col s12 center-align">
            {% if session.role == "Commercial" and session.department == product.department %}
                <a href="{{ url_for('delete_product', product_id=product._id) }}" class="btn-large red accent-3 center-align">
                    <i class="material-icons right">cancel</i> Delete Product
                </a>
            {% endif %}
            <a href="{{ url_for('add_product_details', product_id=product._id) }}" class="btn-large green accent-3 center-align">
                <i class="material-icons right">edit</i> Edit Details
            </a>
            <a href="#" class="btn-large blue accent-3 center-align">
                <i class="material-icons right">local_printshop</i> PDF Form
            </a>
        </div>
    </div>

{% endblock %}